#!/bin/bash
#Drivers Nvidia
  sudo pacman -S --noconfirm --needed nvidia mesa lib32-virtualgl lib32-nvidia-utils primus bumblebee
  sudo gpasswd -a $USER bumblebee 
  sudo pacman -S acpi_call
  modprobe acpi_call
  /usr/share/acpi_call/examples/turn_off_gpu.sh
  /etc/modules-load.d/acpi_call.conf

#Xserver
  sudo pacman -S --noconfirm --needed xorg-server xorg-xinit xorg-xset xorg-xsetroot xorg-xrandr xorg-xrdb glaex2 xterm xorg-xclock xterm xorg-twm

#Nvidia debug
  FILE="/etc/bumblebee/xorg.conf.nvidia"
  N_LINE1="Option "HardDPMS "false"
End Section"Â 
  START_LINE=$(grep -n "Section \"Device\"" $FILE | cut -d: -f1)
  END_LINE=$(grep -n "EndSection" $FILE | awk -F: -v start=$START_LINE '$1 > start {print $1; exit}')
  sed -i "${END_LINE}a\  
  $N_LINE1\
  $N_LINE2" $FILE

#Start X
  cp /etc/X11/xinit/xinitrc ~/.xinitrc
  startx
  glaex2 
  
